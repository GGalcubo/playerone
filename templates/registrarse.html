{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Registrarse | PlayerOne</title>

    <!-- Bootstrap Core CSS -->
    <link href='{% static "css/bootstrap.min.css" %}' rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href='{% static "css/metisMenu.min.css" %}' rel="stylesheet">

    <!-- Custom CSS -->
    <link href='{% static "css/one-page-wonder.css" %}' rel="stylesheet">
    <link href='{% static "css/sb-admin-2.css" %}' rel="stylesheet">

    <!-- Custom Fonts -->
    <link href='{% static "css/font-awesome.min.css" %}' rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

    <body>
    
        {% include "menu.html" %}
        
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-6 col-sm-offset-2 col-md-offset-3">
                    <div class="login-panel panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Registrarse</h3>
                        </div>
                        <div class="panel-body">
                            <div id="errores" style="display:none;" class="alert alert-danger" role="alert"></div>
                            <form role="form" name="form" method="post" action="/registrarse/">{% csrf_token %}
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="text" name="first_name" id="first_name" class="form-control input-lg" placeholder="Nombre" tabindex="1">
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="text" name="last_name" id="last_name" class="form-control input-lg" placeholder="Apellido" tabindex="2">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="text" name="telefono" id="telefono" class="form-control input-lg" placeholder="Telefono" tabindex="3">
                                </div>
                                <div class="form-group">
                                    <input type="email" name="email" id="email" class="form-control input-lg" placeholder="Direccion de mail" tabindex="4">
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="password" name="password" id="password" class="form-control input-lg" placeholder="Password (minimo 6 caracteres)" tabindex="5">
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="password" name="password_confirmation" id="password_confirmation" class="form-control input-lg" placeholder="Confirmar Password" tabindex="6">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-8 col-sm-9 col-md-9">
                                        <span class="radio">
                                            <label>
                                            <input type="radio" name="optionsRadios" id="optionsRadios2" value="option1">Acepto - Al aceptar el <strong class="label label-primary">Registro</strong>, se compromete a los siguientes<a href="#" data-toggle="modal" data-target="#t_and_c_m"> Terminos y condiciones</a>.
                                            </label>
                                        </span>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-12 col-md-6"><input type="button" onclick="validarRegistro();" value="Registro" class="btn btn-primary btn-block btn-lg" tabindex="7"></div>
                                    <div class="col-xs-12 col-md-6"><a href="/ingresar/" class="btn btn-success btn-block btn-lg">Ingresar</a></div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal -->
            <div class="modal fade" id="t_and_c_m" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title" id="myModalLabel">Terminos y condiciones</h4>
                        </div>
                        <div class="modal-body">
                            <p>El servicio es gratis por un periodo de 30 días, pasados los cuales se procedera a dar de baja al servicio.</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Acepto</button>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->
            
            <!-- Footer -->
            <hr class="featurette-divider">

            {% include "footer.html" %}
            
        </div> 
    
        <!-- jQuery -->
        <script src='{% static "js/jquery.js" %}'></script>

        <!-- Bootstrap Core JavaScript -->
        <script src='{% static "js/bootstrap.min.js" %}'></script>

        <!-- Metis Menu Plugin JavaScript -->
        <script src='{% static "js/metisMenu.min.js" %}'></script>

        <!-- Custom Theme JavaScript -->
        <script src='{% static "js/sb-admin-2.js" %}'></script>
        <script src='{% static "js/django_ajax.js" %}'></script>
        
        <script type="text/javascript">
            function validarRegistro(){
                $("#errores").html("")
                $("#errores").hide();
                if ($("#first_name").val() == ""){
                    $("#errores").html("El campo nombre es obligatorio.")
                    $("#errores").show();
                    return false;
                }
                if ($("#last_name").val() == ""){
                    $("#errores").html("El campo apellido es obligatorio.")
                    $("#errores").show();
                    return false;
                }
                if ($("#telefono").val() == ""){
                    $("#errores").html("El campo telefono es obligatorio.")
                    $("#errores").show();
                    return false;
                }
                if ($("#email").val() == ""){
                    $("#errores").html("El campo email es obligatorio.")
                    $("#errores").show();
                    return false;
                }
                
                // Expresion regular para validar el correo
                var regex = /[\w-\.]{2,}@([\w-]{2,}\.)*([\w-]{2,}\.)[\w-]{2,4}/;
                // Se utiliza la funcion test() nativa de JavaScript
                if (!regex.test($('#email').val().trim())) {
                    $("#errores").html("El formato del email no es valido.")
                    $("#errores").show();
                    return false;
                }
                
                if ($("#password").val() == ""){
                    $("#errores").html("El campo password es obligatorio.")
                    $("#errores").show();
                    return false;
                }
                if ($("#password").val().length < 6){
                    $("#errores").html("El campo password debe contener al menos 6 caracteres.")
                    $("#errores").show();
                    return false;
                }
                if ($("#password_confirmation").val() == ""){
                    $("#errores").html("Es obligatorio confirmar el password.")
                    $("#errores").show();
                    return false;
                }
                if ($("#password_confirmation").val() != $("#password").val()){
                    $("#errores").html("No coinciden los passwords.")
                    $("#errores").show();
                    return false;
                }
                if (document.getElementById("optionsRadios2").checked == false){
                    $("#errores").html("No te olvides de aceptar terminos y condiciones.")
                    $("#errores").show();
                    return false;
                }
                
                $.ajax({
                    method: "POST",
                    url: "/registrarse/",
                    data: { nombre: $("#first_name").val(), apellido: $("#last_name").val(), telefono: $("#telefono").val(), email: $("#email").val(), password: $("#password").val(), password_confirmation: $("#password_confirmation").val() },
                    dataType: "json"
                }).done(function(retorno) {
                    if (retorno.error != ""){
                        $("#errores").html(retorno.error)
                        $("#errores").show();
                    }else{
                        var form = $(document.createElement('form'));
                        $(form).attr("action", "/dashboard/");
                        $(form).attr("method", "GET");
                        $(form).submit();
                    }
                });
                
            }
        </script>
    </body>

</html>
